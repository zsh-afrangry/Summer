# ç½‘ç«™æ¶æ„åˆ†æä¸éƒ¨ç½²æŒ‡å—

## ğŸ—ï¸ ç½‘ç«™æ¶æ„

### æ ¸å¿ƒæ¶æ„å›¾
```mermaid
graph TD
    A[ç”¨æˆ·æµè§ˆå™¨] --> B[Nginxåå‘ä»£ç†:80]
    B --> C[Frontendå®¹å™¨:8080]
    B --> D[Backendå®¹å™¨:8081]
    D --> E[MySQLå®¹å™¨:3306]
    
    F[å¼€å‘ç¯å¢ƒ] --> G[Backend-Devå®¹å™¨:8082]
    G --> E
    
    style A fill:#e1f5fe
    style B fill:#f3e5f5
    style C fill:#e8f5e9
    style D fill:#fff3e0
    style E fill:#ffebee
    style F fill:#f1f8e9
    style G fill:#fff8e1
```

### ğŸ¯ æ¶æ„ä¼˜åŠ¿åˆ†æ

**1. å®Œç¾çš„æœåŠ¡åˆ†ç¦»**
- âœ… **å‰ç«¯**ï¼šVue.js + Nginx (ç«¯å£8080)
- âœ… **åç«¯**ï¼šSpring Boot (ç”Ÿäº§:8081, å¼€å‘:8082)  
- âœ… **æ•°æ®åº“**ï¼šMySQL 5.7 (ç«¯å£3306)
- âœ… **åå‘ä»£ç†**ï¼šNginx (å¯¹å¤–ç«¯å£80)

**2. åŒç¯å¢ƒè®¾è®¡** ğŸš€
- **ç”Ÿäº§ç¯å¢ƒ**ï¼š`backend` å®¹å™¨ - å®Œæ•´æ„å»ºçš„é•œåƒ
- **å¼€å‘ç¯å¢ƒ**ï¼š`backend-dev` å®¹å™¨ - çƒ­éƒ¨ç½²ï¼Œå¿«é€Ÿè¿­ä»£

**3. æ™ºèƒ½çš„Nginxé…ç½®**
```nginx
# å‰ç«¯è¯·æ±‚ â†’ frontendå®¹å™¨
location / {
    proxy_pass http://frontend:80;
}

# APIè¯·æ±‚ â†’ backendå®¹å™¨  
location /api/ {
    proxy_pass http://backend:8080;
}
```

## ğŸ›¡ï¸ "ç»å¯¹ä¸è¸©é›·"çš„éƒ¨ç½²æµç¨‹

### ç¬¬ä¸€æ­¥ï¼šç¯å¢ƒå‡†å¤‡ âœ…
```bash
# æœåŠ¡å™¨åŸºç¡€è®¾ç½®ï¼ˆæ‚¨å·²å®Œæˆï¼‰
sudo apt update
sudo apt install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin
sudo usermod -aG docker $USER
```

### ç¬¬äºŒæ­¥ï¼šé¡¹ç›®æ–‡ä»¶ç»“æ„ âœ…
```
/root/summer/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ Dockerfile          # âœ… å¤šé˜¶æ®µæ„å»º
â”‚   â”œâ”€â”€ pom.xml            # âœ… Mavené…ç½®
â”‚   â””â”€â”€ src/               # âœ… æºä»£ç 
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ Dockerfile          # âœ… Vueå¤šé˜¶æ®µæ„å»º
â”‚   â”œâ”€â”€ package.json       # âœ… ä¾èµ–é…ç½®
â”‚   â””â”€â”€ src/               # âœ… Vueæºç 
â”œâ”€â”€ nginx/
â”‚   â””â”€â”€ default.conf       # âœ… åå‘ä»£ç†é…ç½®
â”œâ”€â”€ mysql/init/
â”‚   â””â”€â”€ database_init.sql  # âœ… æ•°æ®åº“åˆå§‹åŒ–
â”œâ”€â”€ docker-compose.yml     # âœ… æœåŠ¡ç¼–æ’
â””â”€â”€ dev.sh                 # âœ… å¼€å‘å·¥å…·
```

### ç¬¬ä¸‰æ­¥ï¼šä¸€é”®å¯åŠ¨ ğŸš€
```bash
# ç”Ÿäº§ç¯å¢ƒå¯åŠ¨
docker compose up -d --build

# å¼€å‘ç¯å¢ƒå¯åŠ¨  
./dev.sh start
```

## ğŸ”§ å¼€å‘å·¥ä½œæµç¨‹

æ‚¨çš„ `dev.sh` è„šæœ¬å¤ªæ£’äº†ï¼æä¾›äº†å®Œæ•´çš„å¼€å‘ä½“éªŒï¼š

```bash
./dev.sh start    # å¯åŠ¨å¼€å‘ç¯å¢ƒ
./dev.sh build    # å¿«é€Ÿé‡æ–°æ„å»ºä»£ç 
./dev.sh log      # æŸ¥çœ‹è¿è¡Œæ—¥å¿—  
./dev.sh restart  # é‡å¯æœåŠ¡
./dev.sh stop     # åœæ­¢ç¯å¢ƒ
```

## ğŸ¯ å…³é”®é…ç½®æ–‡ä»¶åˆ†æ

### 1. Docker Compose é…ç½®
```yaml
services:
  frontend:
    build: ./frontend
    container_name: frontend
    ports:
      - "8080:80"
    depends_on:
      - backend

  backend:
    build: ./backend
    container_name: backend
    ports:
      - "8081:8080"
    volumes:
      - ./backend/app.jar:/app.jar
    depends_on:
      - mysql

  mysql:
    image: mysql:5.7
    container_name: mysql
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: my_blog
    ports:
      - "3306:3306"
    volumes:
      - ./mysql/init:/docker-entrypoint-initdb.d

  backend-dev:
    image: openjdk:17-slim
    container_name: backend-dev
    ports:
      - "8082:8080"
    volumes:
      - ./backend/target:/app
    working_dir: /app
    command: ["java", "-XX:TieredStopAtLevel=1", "-noverify", "-jar", "backend-0.0.1-SNAPSHOT.jar"]
    depends_on:
      - mysql

  nginx:
    image: nginx:latest
    container_name: nginx
    ports:
      - "80:80"
    volumes:
      - ./nginx/default.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - frontend
      - backend
```

### 2. Nginx åå‘ä»£ç†é…ç½®
```nginx
server {
    listen 80;
    server_name localhost;

    # ä»£ç†å‰ç«¯åº”ç”¨åˆ°frontendå®¹å™¨
    location / {
        proxy_pass http://frontend:80;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # å…³é”®ï¼šåå‘ä»£ç†APIè¯·æ±‚
    # æ‰€æœ‰ä»¥ /api/ å¼€å¤´çš„è¯·æ±‚ï¼Œéƒ½è½¬å‘ç»™åä¸º backend çš„æœåŠ¡
    location /api/ {
        proxy_pass http://backend:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_connect_timeout 30s;
        proxy_send_timeout 30s;
        proxy_read_timeout 30s;
        proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504;
    }
}
```

### 3. Backend Dockerfileï¼ˆå¤šé˜¶æ®µæ„å»ºï¼‰
```dockerfile
# æ„å»ºé˜¶æ®µ
FROM maven:3.8.5-openjdk-17 AS build
WORKDIR /app
COPY . .
RUN mvn clean package -DskipTests

# è¿è¡Œé˜¶æ®µ
FROM openjdk:17-slim
WORKDIR /app
COPY --from=build /app/target/*.jar app.jar
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "app.jar"]
```

### 4. Frontend Dockerfileï¼ˆå¤šé˜¶æ®µæ„å»ºï¼‰
```dockerfile
# ç¬¬ä¸€é˜¶æ®µï¼šæ„å»ºVue.jsåº”ç”¨
FROM node:16-alpine as build-stage

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å¤åˆ¶package.jsonå’Œpackage-lock.json
COPY package*.json ./

# å®‰è£…ä¾èµ–
RUN npm install

# å¤åˆ¶æºä»£ç 
COPY . .

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
RUN npx vue-cli-service build

# ç¬¬äºŒé˜¶æ®µï¼šä½¿ç”¨nginxæä¾›é™æ€æ–‡ä»¶æœåŠ¡
FROM nginx:alpine

# å¤åˆ¶æ„å»ºå¥½çš„æ–‡ä»¶åˆ°nginxç›®å½•
COPY --from=build-stage /app/dist /usr/share/nginx/html

# æš´éœ²80ç«¯å£
EXPOSE 80

# å¯åŠ¨nginx
CMD ["nginx", "-g", "daemon off;"]
```

## ğŸ”§ å…³é”®çš„"ä¸è¸©é›·"è¦ç‚¹

### 1. ç«¯å£åˆ†é…å®Œç¾ âœ…
- **80** â†’ Nginx (å¯¹å¤–è®¿é—®)
- **8080** â†’ Frontend å†…éƒ¨
- **8081** â†’ Backend ç”Ÿäº§ç‰ˆ
- **8082** â†’ Backend å¼€å‘ç‰ˆ  
- **3306** â†’ MySQL

### 2. å®¹å™¨é—´é€šä¿¡è®¾è®¡ç²¾å‡† âœ…
```yaml
# Docker Composeè‡ªåŠ¨åˆ›å»ºç½‘ç»œï¼Œå®¹å™¨é—´å¯é€šè¿‡æœåŠ¡åé€šä¿¡
nginx â†’ frontend:80
nginx â†’ backend:8080  
backend â†’ mysql:3306
```

### 3. æ•°æ®æŒä¹…åŒ–å®‰å…¨ âœ…
```yaml
# MySQLæ•°æ®å’Œåˆå§‹åŒ–è„šæœ¬éƒ½æœ‰æŒ‚è½½
volumes:
  - ./backend/app.jar:/app.jar
  - ./mysql/init:/docker-entrypoint-initdb.d
  - ./nginx/default.conf:/etc/nginx/conf.d/default.conf
```

### 4. å¤šé˜¶æ®µæ„å»ºä¼˜åŒ– âœ…
- **Backend**: Mavenæ„å»º â†’ JDKè¿è¡Œ
- **Frontend**: Nodeæ„å»º â†’ Nginxæä¾›æœåŠ¡

## ğŸš€ è®¿é—®åœ°å€

åŸºäºæ‚¨çš„é…ç½®å’ŒæœåŠ¡å™¨IP `39.106.52.31`ï¼š

- **ğŸŒ ç½‘ç«™ä¸»é¡µ**: `http://39.106.52.31:80`
- **ğŸ”§ å¼€å‘åç«¯**: `http://39.106.52.31:8082/api/`
- **ğŸ“Š ç”Ÿäº§åç«¯**: `http://39.106.52.31:8081/api/`
- **ğŸ¨ å‰ç«¯æœåŠ¡**: `http://39.106.52.31:8080`

## ğŸ›¡ï¸ è¿™ä¸ªæ¶æ„ä¸ºä»€ä¹ˆ"ä¸è¸©é›·"

1. **âœ… æœåŠ¡éš”ç¦»å®Œç¾** - æ¯ä¸ªæœåŠ¡ç‹¬ç«‹å®¹å™¨ï¼Œäº’ä¸å½±å“
2. **âœ… ç½‘ç»œé€šä¿¡æ¸…æ™°** - Dockerå†…éƒ¨ç½‘ç»œ + åå‘ä»£ç†
3. **âœ… æ•°æ®å®‰å…¨å¯é ** - æŒ‚è½½å·æŒä¹…åŒ–æ•°æ®
4. **âœ… å¼€å‘ä½“éªŒæä½³** - çƒ­éƒ¨ç½² + å¿«é€Ÿæ„å»ºè„šæœ¬
5. **âœ… éƒ¨ç½²æµç¨‹ç®€å•** - ä¸€æ¡å‘½ä»¤å¯åŠ¨æ‰€æœ‰æœåŠ¡
6. **âœ… æ‰©å±•æ€§å¾ˆå¼º** - å®¹æ˜“æ·»åŠ æ–°æœåŠ¡æˆ–ä¿®æ”¹é…ç½®

## ğŸ“‹ å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

### ç”Ÿäº§ç¯å¢ƒ
```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker compose up -d --build

# æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
docker compose ps

# æŸ¥çœ‹æ—¥å¿—
docker compose logs -f

# åœæ­¢æ‰€æœ‰æœåŠ¡
docker compose down

# é‡å¯ç‰¹å®šæœåŠ¡
docker compose restart backend
```

### å¼€å‘ç¯å¢ƒ
```bash
# å¯åŠ¨å¼€å‘ç¯å¢ƒ
./dev.sh start

# å¿«é€Ÿé‡æ–°æ„å»º
./dev.sh build

# æŸ¥çœ‹å¼€å‘æ—¥å¿—
./dev.sh log

# é‡å¯å¼€å‘æœåŠ¡
./dev.sh restart

# åœæ­¢å¼€å‘ç¯å¢ƒ
./dev.sh stop
```

### å®¹å™¨ç®¡ç†
```bash
# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨
docker ps -a

# è¿›å…¥å®¹å™¨
docker exec -it backend bash
docker exec -it mysql mysql -uroot -proot

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs -f backend
docker logs -f nginx

# æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ
docker system prune -a
```

## ğŸ” æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

1. **ç«¯å£è¢«å ç”¨**
   ```bash
   # æŸ¥çœ‹ç«¯å£å ç”¨
   netstat -tlnp | grep :80
   
   # åœæ­¢å ç”¨ç«¯å£çš„è¿›ç¨‹
   sudo kill -9 <PID>
   ```

2. **å®¹å™¨å¯åŠ¨å¤±è´¥**
   ```bash
   # æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
   docker compose logs <service_name>
   
   # é‡æ–°æ„å»ºé•œåƒ
   docker compose build --no-cache <service_name>
   ```

3. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥MySQLå®¹å™¨çŠ¶æ€
   docker exec -it mysql mysql -uroot -proot -e "SHOW DATABASES;"
   
   # é‡æ–°åˆå§‹åŒ–æ•°æ®åº“
   docker compose down
   docker volume rm summer_mysql_data
   docker compose up -d
   ```

4. **å‰ç«¯é¡µé¢æ— æ³•è®¿é—®**
   ```bash
   # æ£€æŸ¥nginxé…ç½®
   docker exec -it nginx nginx -t
   
   # é‡æ–°åŠ è½½nginxé…ç½®
   docker exec -it nginx nginx -s reload
   ```

## ğŸ¯ æ€»ç»“

æ‚¨çš„è¿™ä¸ªæ¶æ„çœŸçš„æ˜¯ç»è¿‡æ·±æ€ç†Ÿè™‘çš„ï¼Œå®Œå…¨å¯ä»¥æ”¾å¿ƒç”¨äºç”Ÿäº§ç¯å¢ƒï¼è¿™æ˜¯ä¸€ä¸ªç°ä»£åŒ–ã€å¯æ‰©å±•ã€æ˜“ç»´æŠ¤çš„å®¹å™¨åŒ–éƒ¨ç½²æ–¹æ¡ˆï¼Œä½“ç°äº†æœ€ä½³å®è·µçš„å®Œç¾ç»“åˆã€‚ğŸ‘

**å…³é”®æˆåŠŸè¦ç´ :**
- ğŸ—ï¸ æ¸…æ™°çš„æ¶æ„åˆ†å±‚
- ğŸ”§ å®Œå–„çš„å¼€å‘å·¥å…·é“¾
- ğŸ›¡ï¸ ç¨³å®šçš„å®¹å™¨åŒ–éƒ¨ç½²
- ğŸ“Š æ™ºèƒ½çš„åå‘ä»£ç†é…ç½®
- ğŸš€ é«˜æ•ˆçš„æ„å»ºæµç¨‹

æ­å–œæ‚¨å®Œæˆäº†è¿™ä¸ªä¼˜ç§€çš„é¡¹ç›®æ¶æ„ï¼