# ================================
# Summer é¡¹ç›® Docker å¼€å‘æ‰‹å†Œ
# ================================

æœ¬æ‰‹å†ŒåŒ…å« Summer é¡¹ç›®çš„å®Œæ•´ Docker å¼€å‘æµç¨‹å’Œå¸¸ç”¨å‘½ä»¤ã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
summer/
â”œâ”€â”€ docker-compose.dev.yml    # æœ¬åœ°å¼€å‘ç¯å¢ƒï¼ˆçƒ­æ›´æ–°ï¼‰
â”œâ”€â”€ docker-compose.prod.yml   # ç”Ÿäº§éƒ¨ç½²ç¯å¢ƒ
â”œâ”€â”€ frontend/                 # Vue.js å‰ç«¯
â”‚   â”œâ”€â”€ Dockerfile           # ç”Ÿäº§æ„å»º
â”‚   â””â”€â”€ Dockerfile.dev       # å¼€å‘ç¯å¢ƒ
â”œâ”€â”€ backend/                  # Spring Boot åç«¯
â”‚   â”œâ”€â”€ Dockerfile           # ç”Ÿäº§æ„å»º
â”‚   â””â”€â”€ Dockerfile.dev       # å¼€å‘ç¯å¢ƒ
â””â”€â”€ nginx/
    â”œâ”€â”€ default.conf         # ç”Ÿäº§ç¯å¢ƒé…ç½®
    â””â”€â”€ nginx-dev.conf       # å¼€å‘ç¯å¢ƒé…ç½®
```

# ================================
# ğŸš€ å¿«é€Ÿå¼€å§‹
# ================================

## æœ¬åœ°å¼€å‘ç¯å¢ƒå¯åŠ¨ï¼ˆæ¨èï¼‰
docker compose -f docker-compose.dev.yml up -d
# ä½œç”¨ï¼šå¯åŠ¨æ”¯æŒçƒ­æ›´æ–°çš„å¼€å‘ç¯å¢ƒ
# - å‰ç«¯ï¼šVue dev serverï¼Œä»£ç ä¿®æ”¹ç«‹å³ç”Ÿæ•ˆ
# - åç«¯ï¼šSpring DevToolsï¼Œæ”¯æŒçƒ­é‡è½½
# - æ•°æ®åº“ï¼šMySQL 5.7
# - è®¿é—®ï¼šhttp://localhost:8080

## æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker compose -f docker-compose.dev.yml ps
# ä½œç”¨ï¼šæ˜¾ç¤ºæ‰€æœ‰å¼€å‘ç¯å¢ƒå®¹å™¨çš„è¿è¡ŒçŠ¶æ€

## åœæ­¢å¼€å‘ç¯å¢ƒ
docker compose -f docker-compose.dev.yml down
# ä½œç”¨ï¼šåœæ­¢å¹¶åˆ é™¤å¼€å‘ç¯å¢ƒçš„æ‰€æœ‰å®¹å™¨

# ================================
# ğŸ› ï¸ å¼€å‘å¸¸ç”¨å‘½ä»¤
# ================================

## é‡å»ºå‰ç«¯ï¼ˆå‰ç«¯ä¾èµ–å˜åŒ–æ—¶ï¼‰
docker compose -f docker-compose.dev.yml up --build frontend-dev -d
# ä½œç”¨ï¼šåªé‡å»ºå‰ç«¯æœåŠ¡ï¼Œé€‚ç”¨äºï¼š
# - package.json ä¾èµ–æ›´æ–°
# - å‰ç«¯ Dockerfile ä¿®æ”¹

## åç«¯ä»£ç æ›´æ–°æµç¨‹
# 1. åœæ­¢å¼€å‘ç¯å¢ƒ
docker compose -f docker-compose.dev.yml down
# 2. æ„å»ºæ–°çš„åç«¯é•œåƒï¼ˆä½¿ç”¨ç”Ÿäº§é…ç½®ï¼‰
docker compose up --build backend -d
# 3. é‡å¯å¼€å‘ç¯å¢ƒ
docker compose -f docker-compose.dev.yml up -d
# ä½œç”¨ï¼šæ›´æ–°åç«¯ä»£ç å¹¶é‡æ–°éƒ¨ç½²

## æŸ¥çœ‹å®æ—¶æ—¥å¿—
docker compose -f docker-compose.dev.yml logs -f
# ä½œç”¨ï¼šæ˜¾ç¤ºæ‰€æœ‰æœåŠ¡çš„å®æ—¶æ—¥å¿—è¾“å‡º

## æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker compose -f docker-compose.dev.yml logs -f frontend-dev
docker compose -f docker-compose.dev.yml logs -f backend-dev
docker compose -f docker-compose.dev.yml logs -f mysql-dev
docker compose -f docker-compose.dev.yml logs -f nginx-dev
# ä½œç”¨ï¼šæŸ¥çœ‹æŒ‡å®šæœåŠ¡çš„æ—¥å¿—ï¼Œä¾¿äºè°ƒè¯•

## é‡å¯ç‰¹å®šæœåŠ¡
docker compose -f docker-compose.dev.yml restart frontend-dev
docker compose -f docker-compose.dev.yml restart backend-dev
# ä½œç”¨ï¼šé‡å¯æŒ‡å®šæœåŠ¡ï¼Œä¿æŒå…¶ä»–æœåŠ¡è¿è¡Œ

# ================================
# ğŸ”§ è°ƒè¯•å’Œç»´æŠ¤
# ================================

## è¿›å…¥å®¹å™¨å†…éƒ¨è°ƒè¯•
docker exec -it frontend-dev /bin/sh
docker exec -it backend-dev /bin/bash
docker exec -it mysql-dev mysql -uroot -proot
# ä½œç”¨ï¼šè¿›å…¥å®¹å™¨å†…éƒ¨è¿›è¡Œè°ƒè¯•å’Œæ’é”™

## æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ
docker stats
# ä½œç”¨ï¼šå®æ—¶æ˜¾ç¤ºå®¹å™¨çš„CPUã€å†…å­˜ä½¿ç”¨æƒ…å†µ

## æ¸…ç†å¼€å‘ç¯å¢ƒæ•°æ®
docker compose -f docker-compose.dev.yml down -v
# ä½œç”¨ï¼šåœæ­¢æœåŠ¡å¹¶åˆ é™¤æ‰€æœ‰ç›¸å…³çš„volumeæ•°æ®
# æ³¨æ„ï¼šè¿™ä¼šåˆ é™¤æ•°æ®åº“æ•°æ®ï¼

## åªåˆ é™¤å®¹å™¨ï¼Œä¿ç•™æ•°æ®
docker compose -f docker-compose.dev.yml down
# ä½œç”¨ï¼šåœæ­¢å¹¶åˆ é™¤å®¹å™¨ï¼Œä½†ä¿ç•™volumeä¸­çš„æ•°æ®

# ================================
# ğŸš€ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
# ================================

## ç”Ÿäº§ç¯å¢ƒå¯åŠ¨
docker compose -f docker-compose.prod.yml up -d
# ä½œç”¨ï¼šå¯åŠ¨ç”Ÿäº§ç¯å¢ƒ
# - ä½¿ç”¨é¢„æ„å»ºçš„ä¼˜åŒ–é•œåƒ
# - æ•°æ®æŒä¹…åŒ–
# - è®¿é—®ï¼šhttp://localhost:80

## ç”Ÿäº§ç¯å¢ƒçŠ¶æ€æŸ¥çœ‹
docker compose -f docker-compose.prod.yml ps
# ä½œç”¨ï¼šæŸ¥çœ‹ç”Ÿäº§ç¯å¢ƒå®¹å™¨çŠ¶æ€

## ç”Ÿäº§ç¯å¢ƒåœæ­¢
docker compose -f docker-compose.prod.yml down
# ä½œç”¨ï¼šåœæ­¢ç”Ÿäº§ç¯å¢ƒ

# ================================
# ğŸ§¹ ç³»ç»Ÿæ¸…ç†å‘½ä»¤
# ================================

## æ¸…ç†æœªä½¿ç”¨çš„é•œåƒå’Œå®¹å™¨
docker system prune -f
# ä½œç”¨ï¼šåˆ é™¤åœæ­¢çš„å®¹å™¨ã€æœªä½¿ç”¨çš„ç½‘ç»œå’Œæ‚¬ç©ºé•œåƒ

## æ·±åº¦æ¸…ç†ï¼ˆåŒ…æ‹¬æœªä½¿ç”¨çš„é•œåƒï¼‰
docker system prune -a -f
# ä½œç”¨ï¼šåˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„Dockerå¯¹è±¡
# æ³¨æ„ï¼šä¼šåˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒï¼Œè°¨æ…ä½¿ç”¨

## æ¸…ç†ç‰¹å®šé•œåƒ
docker rmi afrangry/summer-frontend:latest
docker rmi afrangry/summer-backend:latest
# ä½œç”¨ï¼šåˆ é™¤æŒ‡å®šé•œåƒï¼Œå¼ºåˆ¶é‡å»º

## æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ
docker system df
# ä½œç”¨ï¼šæ˜¾ç¤ºDockerå ç”¨çš„ç£ç›˜ç©ºé—´

# ================================
# ğŸŒ è®¿é—®åœ°å€
# ================================

## å¼€å‘ç¯å¢ƒè®¿é—®åœ°å€
- å‰ç«¯é¡µé¢ï¼šhttp://localhost:8080 ï¼ˆnginxä»£ç†ï¼Œæ¨èï¼‰
- å‰ç«¯ç›´è¿ï¼šhttp://localhost:3000 ï¼ˆVue dev serverï¼‰
- åç«¯APIï¼šhttp://localhost:9000
- æ•°æ®åº“ï¼šlocalhost:3307 (root/root)

## ç”Ÿäº§ç¯å¢ƒè®¿é—®åœ°å€
- å‰ç«¯é¡µé¢ï¼šhttp://localhost:80
- åç«¯APIï¼šhttp://localhost:8081
- æ•°æ®åº“ï¼šlocalhost:3307 (root/root)

# ================================
# â— å¸¸è§é—®é¢˜è§£å†³
# ================================

## é—®é¢˜1ï¼šç«¯å£è¢«å ç”¨
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -ano | findstr :80
netstat -ano | findstr :3000
netstat -ano | findstr :8080
netstat -ano | findstr :9000
netstat -ano | findstr :3307

# è§£å†³æ–¹æ¡ˆï¼š
# 1. åœæ­¢å ç”¨ç«¯å£çš„ç¨‹åº
# 2. æˆ–ä¿®æ”¹docker-composeä¸­çš„ç«¯å£æ˜ å°„

## é—®é¢˜2ï¼šä»£ç ä¿®æ”¹ä¸ç”Ÿæ•ˆ
# å¼€å‘ç¯å¢ƒåº”è¯¥è‡ªåŠ¨çƒ­æ›´æ–°ï¼Œå¦‚æœä¸ç”Ÿæ•ˆï¼š
docker compose -f docker-compose.dev.yml restart frontend-dev
# ä½œç”¨ï¼šé‡å¯å‰ç«¯æœåŠ¡

# å¦‚æœä»ä¸ç”Ÿæ•ˆï¼Œæ£€æŸ¥volumeæŒ‚è½½ï¼š
docker compose -f docker-compose.dev.yml down
docker compose -f docker-compose.dev.yml up -d

## é—®é¢˜3ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥
# æ£€æŸ¥MySQLå®¹å™¨çŠ¶æ€
docker compose -f docker-compose.dev.yml logs mysql-dev
# ç­‰å¾…MySQLå®Œå…¨å¯åŠ¨ï¼ˆçº¦30ç§’ï¼‰

# æµ‹è¯•æ•°æ®åº“è¿æ¥
docker exec -it mysql-dev mysql -uroot -proot -e "SHOW DATABASES;"

## é—®é¢˜4ï¼šå‰ç«¯é¡µé¢æ— æ³•è®¿é—®
# æ£€æŸ¥nginxå’Œå‰ç«¯å®¹å™¨çŠ¶æ€
docker compose -f docker-compose.dev.yml logs nginx-dev
docker compose -f docker-compose.dev.yml logs frontend-dev

# ç¡®è®¤ç«¯å£æ˜ å°„æ­£ç¡®
docker compose -f docker-compose.dev.yml ps

## é—®é¢˜5ï¼šå†…å­˜ä¸è¶³
# æ£€æŸ¥å®¹å™¨èµ„æºä½¿ç”¨
docker stats

# æ¸…ç†æ— ç”¨èµ„æº
docker system prune -f

# å¢åŠ Dockerå†…å­˜é™åˆ¶ï¼ˆDocker Desktopè®¾ç½®ï¼‰

# ================================
# ğŸ”„ å¼€å‘å·¥ä½œæµç¨‹
# ================================

## æ—¥å¸¸å¼€å‘æµç¨‹
1. å¯åŠ¨å¼€å‘ç¯å¢ƒ
   docker compose -f docker-compose.dev.yml up -d

2. å¼€å‘ä»£ç ï¼ˆè‡ªåŠ¨çƒ­æ›´æ–°ï¼‰
   - ä¿®æ”¹ frontend/src/ ä¸‹çš„æ–‡ä»¶
   - ä¿®æ”¹ backend/src/ ä¸‹çš„æ–‡ä»¶
   - æµè§ˆå™¨è‡ªåŠ¨åˆ·æ–°æ˜¾ç¤ºæ›´æ”¹

3. æŸ¥çœ‹æ—¥å¿—è°ƒè¯•
   docker compose -f docker-compose.dev.yml logs -f

4. ç»“æŸå¼€å‘
   docker compose -f docker-compose.dev.yml down

## æ–°åŠŸèƒ½å¼€å‘æµç¨‹
1. åˆ›å»ºæ–°åˆ†æ”¯
2. å¯åŠ¨å¼€å‘ç¯å¢ƒ
3. å¼€å‘æ–°åŠŸèƒ½
4. æµ‹è¯•åŠŸèƒ½
5. æäº¤ä»£ç 

## ä¾èµ–æ›´æ–°æµç¨‹
1. ä¿®æ”¹ package.json æˆ– pom.xml
2. é‡å»ºç¯å¢ƒï¼š
   docker compose -f docker-compose.dev.yml down
   docker compose -f docker-compose.dev.yml up --build -d

# ================================
# ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®
# ================================

## å¼€å‘ç¯å¢ƒä¼˜åŒ–
1. å®šæœŸæ¸…ç†æ— ç”¨èµ„æºï¼šdocker system prune -f
2. ä½¿ç”¨ .dockerignore å‡å°‘æ„å»ºä¸Šä¸‹æ–‡
3. åˆç†é…ç½®å†…å­˜é™åˆ¶
4. ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºä¼˜åŒ–é•œåƒå¤§å°

## çƒ­æ›´æ–°ä¼˜åŒ–
1. ç¡®ä¿æ–‡ä»¶ç›‘å¬æ­£å¸¸å·¥ä½œ
2. é¿å…ç›‘å¬ node_modules ç›®å½•
3. ä½¿ç”¨è½®è¯¢æ¨¡å¼å¤„ç†æ–‡ä»¶ç³»ç»Ÿå…¼å®¹æ€§

# ================================
# ğŸ“ å¤‡æ³¨
# ================================

- å¼€å‘ç¯å¢ƒæ”¯æŒçƒ­æ›´æ–°ï¼Œä¿®æ”¹ä»£ç æ— éœ€é‡å¯
- ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ä¼˜åŒ–åçš„é™æ€æ–‡ä»¶
- æ•°æ®åº“æ•°æ®åœ¨å¼€å‘ç¯å¢ƒä¸­é»˜è®¤ä¸æŒä¹…åŒ–
- å¦‚éœ€æŒä¹…åŒ–æ•°æ®ï¼Œé¿å…ä½¿ç”¨ down -v å‘½ä»¤